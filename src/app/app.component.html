<div class="k-grid">
  <kendo-grid #grid [data]="gridView" [height]="500" [resizable]="true" [pageSize]="pageSize"
    [skip]="gridCurrentState.skip" [sort]="gridCurrentState.sort" [filter]="gridCurrentState.filter"
    [sortable]="{ mode: 'multiple'}" [pageable]="true" filterable="menu" [groupable]="groupable"
    [group]="gridCurrentState.group" [columnMenu]="{filter: {expanded: true}, columnChooser: false  }"
    (groupChange)="groupChange($event)" (dataStateChange)="dataStateChange($event)" (sortChange)="sortChange($event)"
    (pageChange)="pageChange($event)" (add)="addHandler($event)" (edit)="editHandler($event)"
    (save)="saveHandler($event)" (remove)="removeHandler($event)" (cancel)="cancelHandler($event)">
    <kendo-grid-messages [filter]="'Filtro'" [filterAfterOperator]="'Es superior a'"
      [filterAfterOrEqualOperator]="'Es superior a'" [filterAndLogic]="'Y'" [filterBeforeOperator]="'Es anterior a'"
      [filterBeforeOrEqualOperator]="'Es anterior o igual a'" [filterBooleanAll]="'Todo'"
      [filterClearButton]="'Limpiar'" [filterContainsOperator]="'Contiene'" [filterEndsWithOperator]="'Finaliza con'"
      [filterEqOperator]="'Es igual que'" [filterFilterButton]="'Filtrar'" [filterGtOperator]="'Es más grande que'"
      [filterGteOperator]="'Es más grande o igual que'" [filterIsEmptyOperator]="'Es vacío'"
      [filterIsFalse]="'Es falso'" [filterIsNotEmptyOperator]="'No está vacío'" [filterIsNotNullOperator]="'No es nulo'"
      [filterIsNullOperator]="'Es nulo'" [filterIsTrue]="'Es verdadero'" [filterLtOperator]="'Es menor que'"
      [filterLteOperator]="'Es menor o igual que'" [filterNotContainsOperator]="'No contiene'"
      [filterNotEqOperator]="'No es igual a'" [filterOrLogic]="'O'" [filterStartsWithOperator]="'Empieza con'"
      [pagerFirstPage]="'Ir a la primera página'" [pagerItems]="'registros'"
      [pagerItemsPerPage]="'registros por página'" [pagerOf]="'de'"
      [groupPanelEmpty]="'Arrastra una categoría a esta barra para agrupar'">
      ></kendo-grid-messages>

    <kendo-grid-column media="xs" title="Puestos">
      <ng-template kendoGridCellTemplate let-dataItem="dataItem">
        <div fxFlex=100>
          <div fxLayout="row">
            <div fxLayout="column" fxFlex="90" fxLayoutAlign="start">
              <h4 [class.discontinued]="dataItem.Discontinued">
                {{ dataItem.puestoId }}
              </h4>
              <dl>
                <dt>Código oficial</dt>
                <dd>{{ dataItem.puestoIdOficial }}</dd>

                <dt>Denominación</dt>
                <dd>{{ dataItem.puestoTipo?.nombre }}</dd>

                <dt>Inicio Fecha Vigencia</dt>
                <dd>{{ dataItem.fechaVigenciaInicio | date }}</dd>

                <dt>Disponibilidad</dt>
                <dd><input type="checkbox" [checked]="dataItem.disponibilidadPlena" disabled /></dd>
              </dl>
            </div>
            <div fxLayout="column" fxLayoutAlign="start end">
              <span>
                <div>
                  <button mat-button [matMenuTriggerFor]="menu" class="k-icon k-i-more-vertical"></button>
                  <mat-menu #menu="matMenu">
                    <button mat-menu-item kendoGridEditCommand>Editar</button>
                    <button mat-menu-item kendoGridRemoveCommand>Borrar</button>
                  </mat-menu>
                </div>
              </span>
            </div>
          </div>
        </div>
      </ng-template>

      <ng-template kendoGridEditTemplate let-isNew="isNew" let-dataItem="dataItem" let-formGroup>
        <mat-card>
          <mat-card-content>
            <div fxFlex=100>
              <div fxLayout="row-wrap">

                <div fxFlex="100" fxFlex.xs="100" fxFlexAlign="end">
                  <button kendoGridSaveCommand mat-icon-button [disabled]="formGroup?.invalid">
                    <span class="k-icon k-i-check k-i-checkmark" matTooltip='{{ isNew ? "Add" : "Update" }}'></span>
                  </button>
                  <button kendoGridCancelCommand mat-icon-button>
                    <span class="k-icon k-i-cancel" matTooltip='{{ isNew ? "Discard changes" : "Cancel" }}'></span>
                  </button>
                </div>

                <div fxFlex="100" fxFlexAlign="start center" style=" padding:5px;">
                  <mat-form-field style="width:100%">
                    <input matInput [formControl]="formGroup.get('puestoIdOficial')" placeholder="{{'Código oficial'}}">
                  </mat-form-field>
                </div>
                <div fxFlex="100" fxFlexAlign="start center" style=" padding:5px;">
                  <mat-form-field>
                    <input matInput [formControl]="formGroup.get('puestoTipo.nombre')" placeholder="{{'Denominación'}}">
                  </mat-form-field>
                </div>

              </div>
              <div fxLayout="row">
                <div fxFlexAlign="start center" style=" padding:5px 0px 5px 50px;">
                  <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                  <mat-datepicker #picker></mat-datepicker>
                </div>
                <div fxFlexAlign="start center" style=" padding:15px;">
                  <input matInput [matDatepicker]="picker" [formControl]="formGroup.get('fechaVigenciaInicio')">
                </div>
                <div fxFlexAlign="start center" style=" padding:15px;">
                  <mat-slide-toggle [checked]="dataItem.disponibilidadPlena" labelPosition="after"
                    [formControl]="formGroup.get('disponibilidadPlena')">
                    <span>Disponibilidad</span>
                  </mat-slide-toggle>
                </div>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </ng-template>
    </kendo-grid-column>


    <ng-template kendoGridToolbarTemplate>
      <div kendoGridAddCommand class="k-button k-bare">
        <span class="k-icon k-i-plus-circle k-icon-25 colored-icon" style="color: rgb(49, 49, 209);"
          matTooltip="Añadir nuevo puesto"></span>
      </div>
      <kendo-grid-spacer></kendo-grid-spacer>
      <input type="text" *ngIf="search" placeholder="Buscar puesto..." kendoTextBox
        (input)="onFilter($event.target.value)">
      <div (click)="showSearch()" class="k-button k-bare">
        <span class="k-icon k-i-search " matTooltip="Buscar puestos"></span>
      </div>
      <div (click)="showGroupable()" class="k-button k-bare">
        <span class="k-icon k-i-aggregate-fields" *ngIf="!groupable" matTooltip="Mostrar agrupar columnas"></span>
        <span class="k-icon k-i-align-remove" *ngIf="groupable" matTooltip="Desactivar agrupar columnas"></span>
      </div>
      <div kendoGridExcelCommand class="k-button k-bare">
        <span class="k-icon k-i-download" matTooltip="Descargar excel"></span>
      </div>
      <kendo-grid-column-chooser matTooltip="Mostrar columnas"></kendo-grid-column-chooser>
    </ng-template>
    <kendo-grid-command-column media="md" [width]="110" [resizable]="false">
      <ng-template kendoGridCellTemplate let-isNew="isNew" let-dataItem="dataItem" let-rowIndex="rowIndex"
        let-columnIndex="columnIndex">
        <div>
          <button kendoGridEditCommand mat-icon-button *ngIf="!isNew">
            <span class="k-icon k-i-edit k-i-pencil" matTooltip="Editar"></span>
          </button>
          <button kendoGridRemoveCommand mat-icon-button *ngIf="!isNew">
            <span class="k-icon k-i-x" matTooltip="Eliminar"></span>
          </button>
          <button kendoGridSaveCommand mat-icon-button [disabled]="formGroup?.invalid">
            <span class="k-icon k-i-check k-i-checkmark" matTooltip='{{ isNew ? "Add" : "Update" }}'></span>
          </button>
          <button kendoGridCancelCommand mat-icon-button>
            <span class="k-icon k-i-cancel" matTooltip='{{ isNew ? "Discard changes" : "Cancel" }}'></span>
          </button>
        </div>
      </ng-template>
    </kendo-grid-command-column>

    <kendo-grid-column field="puestoId" title="Cód." [width]="100" media="md">
    </kendo-grid-column>
    <kendo-grid-column field="puestoIdOficial" title="Código oficial" [width]="100" media="md">
    </kendo-grid-column>
    <kendo-grid-column field='tipoVinculo.nombre' title="TP" [width]="100" media="md">
    </kendo-grid-column>
    <kendo-grid-column field="puestoTipo.nombre" title="Denominación" [width]="200" media="md">
    </kendo-grid-column>
    <kendo-grid-column field="catalogo.nombre" title="Catálogo" [width]="200" media="md">
    </kendo-grid-column>
    <kendo-grid-column field="adscripcion.nombre" title="Adscripción administración" [width]="200" media="md">
    </kendo-grid-column>
    <kendo-grid-column field="grupo1Id" title="G1" [width]="80" media="md">
    </kendo-grid-column>
    <kendo-grid-column field="grupo2Id" title="G2" [width]="80" media="md">
    </kendo-grid-column>
    <kendo-grid-column field="escala.nombre" title="Escala" [width]="400" media="md">
    </kendo-grid-column>
    <kendo-grid-column type="checkbox" field="disponibilidadPlena" title="Disponibilidad" [width]="80" filter="boolean"
      media="md" editor="boolean">
      <ng-template kendoGridCellTemplate let-dataItem>
        <input type="checkbox" [checked]="dataItem.disponibilidadPlena" disabled />
      </ng-template>
    </kendo-grid-column>
    <kendo-grid-column field="fechaVigenciaInicio" title="Inicio Fecha Vigencia" [width]="400" filter="date" media="md"
      editor="date">
      <ng-template kendoGridCellTemplate let-dataItem>
        {{dataItem.fechaVigenciaInicio | date}}
      </ng-template>
    </kendo-grid-column>
    <kendo-grid-excel fileName="Puestos.xlsx"></kendo-grid-excel>
  </kendo-grid>
</div>